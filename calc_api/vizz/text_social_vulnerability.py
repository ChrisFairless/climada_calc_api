from string import Template
from millify import millify
import numpy as np

from calc_api.vizz.util import options_return_period_to_description, options_scenario_to_description
from calc_api.vizz import schemas_widgets


def generate_social_vulnerability_widget_text(
        hazard_type,
        location,
        location_type,
        scenario,
        impact_type,
        exposure_units,
        value_present,
        affected_present,
        affected_future,
        affected_future_exposure_change,
        affected_future_climate_change,
        future_year,
        return_period,
):
    intro_text = _generate_social_vulnerability_widget_intro_text()
    haz_overview_text = _generate_social_vulnerability_widget_hazard_overview_text(hazard_type)
    # soc_vuln_data_text = _generate_social_vulnerability_widget_data_text()

    # TODO make useful social vulnerability information here
    return [intro_text, haz_overview_text]


def _generate_social_vulnerability_widget_intro_text():
    text = "Not everyone experiences the effects of climate change equally. Societies are structured giving some groups disproportionate access to resources which in turn affects their vulnerability to extreme events and ability to adapt. "
    return schemas_widgets.GeneratedText(
        template=text,
        values=[]
    )


def _generate_social_vulnerability_widget_hazard_overview_text(hazard_type):
    if hazard_type == 'tropical_cyclone':
        text = "Tropical cyclones have disproportionate effects on the elderly, the disabled, children under the age of 5, migrant communities and people without their own means of transport. These are collectively identified as the population at greater risk to tropical storms and adaptation measures should be targeted accordingly."
    elif hazard_type == 'extreme_heat':
        text = "Extreme heat has disproportionate effects on the elderly, the disabled, children under the age of 5, outdoor workers and  indoor workers without cooling, people with co-morbidities, and people unable to cool their homes. These are collectively identified as the population at greater risk to extreme heat and adaptation measures should be targeted accordingly."
    else:
        raise ValueError(f'{hazard_type} is not in my list of pre-prepared hazards for text generation')

    return schemas_widgets.GeneratedText(
        template=text,
        values=[]
    )

#
# def _generate_social_vulnerability_widget_data_text(location, location_type):
#
#     if location_type != 'country':
#         text = Template(
#             'Communities in $location are $comparison vulnerable than in the whole of $country'
#         )
#
#     return schemas_widgets.GeneratedText(
#         template=final_text,
#         values=text_numeric_values
#     )
